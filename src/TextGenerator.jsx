import React, { useEffect } from "react";
import { useState } from "react";
import { Configuration, OpenAIApi } from "openai";
import "./TextGenerator.css";
import Output from "./Output";


function TextGenerator() {
  const [prompt, setPrompt] = useState("");
  const [output, setOutput] = useState('');
  const [loading, setLoading] = useState(false);
  
  const apiKey = import.meta.env.VITE_OPENAI_KEY;
  const orgKey = import.meta.env.VITE_ORGANIZATION_KEY;
  
 
  // Add Text
  const generateOutput = async (e) => {
    e.preventDefault();
    setLoading(true);
    
      const apiRequestBody = {
        'model': "text-davinci-003",
        'prompt': prompt,
        'temperature': 0.5,
        'max_tokens': 200,
        'top_p': 1.0,
        'n': 1,
        'frequency_penalty': 0.0,
        'presence_penalty': 0.0,
     };
    
    await fetch('https://api.openai.com/v1/models/text-davinci-003', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + apiKey,
                'OpenAI-Organization': orgKey,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(apiRequestBody)
        }).then((res) => {
            return res.json();
        }).then((data) => {
            const response = data.choices[0].text;
            setOutput(response);
            setLoading(false);
        })
  }

  return (
    <div className="TextGenerator">
      <form onSubmit={generateOutput}>
        <p className="">Hello Guest, How can I help you ?</p>
        <input
          className="ipt prompt"
          type="text"
          value={prompt}
          placeholder="Type something to generate a Text.. "
          onChange={(e) => {
            setPrompt(e.target.value);
          }}
        />
        <button type="submit" className="btn" onClick={generateOutput}>
          Generate a Text
        </button>
      </form>

      <div className="generetedText">
        {loading ? 'loading...' : <Output response={output} />}
      </div>

    </div>
  );
}

export default TextGenerator;
